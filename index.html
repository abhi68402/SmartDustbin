<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Dustbin Management</title>
  <style>
    /* Your CSS styling remains the same */
    /* Refer to the original CSS you've shared */
  </style>
</head>
<body>
  <header>
    <h1>Smart Dustbins</h1>
  </header>

  <!-- Navigation Menu -->
  <nav>
    <a href="#dustbinInfo">Dustbin Info</a>
    <a href="#maps">Maps</a>
    <a href="#settings">Settings</a>
    <a href="#helpSupport">Help and Support</a>
  </nav>

  <div id="dustbinList">
    <div class="container">
      <!-- Dustbin Cards will be dynamically inserted here -->
      <h2 id="dustbinInfo">Dustbin Status</h2>
      <div id="dustbinData"></div> <!-- Placeholder for dustbin data -->
    </div>
  </div>

  <h2>Bins to Be Cleaned (Above 80% Fill)</h2>
  <div id="dustbinsToBeCleaned"></div>

  <h2 id="maps">Optimized Route for Cleaning Bins</h2>
  <button id="optimizedRoute" onclick="showOptimizedRoute()">Get Optimized Route</button>
  <div class="map-section">
    <iframe id="mapIframe" src="https://www.google.com/maps/d/embed?mid=1UJBv5938Wa8JN1n2x-qaDCNOHFFBpr4&usp=sharing" width="640" height="480"></iframe>
  </div>

  <!-- Settings Section -->
  <div id="settings" class="action-buttons">
    <p>
      <button id="addDustbinButton">Add Dustbin</button>
      <button id="removeDustbinButton">Remove Dustbin</button>
    </p>
  </div>

  <!-- Help and Support Section -->
  <div id="helpSupport" class="help-support">
    <h3>Help and Support</h3>
    <p>Email: support@smartbins.in</p>
    <p>Contact: 8919884369</p>
    <p>Location: GITAM, Rushikonda, 530017</p>
    <div class="contact-btns">
      <button onclick="window.location.href='tel:+918919884369'">Call Support</button>
      <button onclick="window.location.href='mailto:support@smartbins.in'">Email Support</button>
      <button onclick="window.location.href='https://www.google.com/maps?q=GITAM,+Rushikonda,+530017'">View Location</button>
    </div>
  </div>

  <script>
    // Fetch data from ThingSpeak API and update the dustbin data
    function fetchDustbinData() {
      fetch("https://api.thingspeak.com/channels/CHANNEL_ID/feeds.json?api_key=YOUR_API_KEY")
        .then((response) => {
          if (response.ok) {
            return response.json();
          } else {
            throw new Error("NETWORK RESPONSE ERROR");
          }
        })
        .then(data => {
          console.log(data);
          displayDustbinData(data.feeds);
        })
        .catch((error) => console.error("FETCH ERROR:", error));
    }

    // Function to display the fetched dustbin data
    function displayDustbinData(feeds) {
      const dustbinContainer = document.getElementById('dustbinData');
      const dustbinsToBeCleaned = document.getElementById('dustbinsToBeCleaned');

      dustbinContainer.innerHTML = '';
      dustbinsToBeCleaned.innerHTML = '';

      feeds.forEach((feed, index) => {
        const fillLevel = parseInt(feed.field1); // Assuming field1 contains the fill level
        const dustbinHTML = `
          <div class="dustbin-card" data-fill="${fillLevel}">
            <img src="https://www.bing.com/images/blob?bcid=r1y-ScL7e94HSw" alt="Dustbin Image">
            <div class="dustbin-info">
              <h3>Dustbin ${index + 1}</h3>
              <p>Location: Example Location ${index + 1}</p>
            </div>
            <div class="dustbin-status">
              <span class="status-label ${getStatusLabelClass(fillLevel)}">${getStatusLabel(fillLevel)}</span>
              <p>Fill Level: ${fillLevel}%</p>
              <div class="fill-level-bar">
                <div style="width: ${fillLevel}%;"></div>
              </div>
              <p>Waste Age: ${Math.floor(Math.random() * 4 + 1)} days</p>
              <input type="checkbox" id="selectDustbin${index + 1}" data-lat="17.78${index}001" data-lon="83.37${index}001">
              <label for="selectDustbin${index + 1}">Select Dustbin</label>
            </div>
          </div>
        `;

        dustbinContainer.innerHTML += dustbinHTML;

        // Filter bins with fill level > 80%
        if (fillLevel > 80) {
          dustbinsToBeCleaned.innerHTML += dustbinHTML;
        }
      });
    }

    // Helper functions to get status label and class based on fill level
    function getStatusLabel(fillLevel) {
      if (fillLevel > 80) return 'High';
      if (fillLevel > 50) return 'Medium';
      return 'Low';
    }

    function getStatusLabelClass(fillLevel) {
      if (fillLevel > 80) return 'high-status';
      if (fillLevel > 50) return 'medium-status';
      return 'low-status';
    }

    // Show optimized route (same logic as provided)
    function showOptimizedRoute() {
      navigator.geolocation.getCurrentPosition(
        (position) => {
          const userLat = position.coords.latitude;
          const userLon = position.coords.longitude;
          const origin = `${userLat},${userLon}`;

          const selectedDustbins = document.querySelectorAll('input[type=checkbox]:checked');
          const coordinates = Array.from(selectedDustbins).map(checkbox => {
            const lat = checkbox.getAttribute('data-lat');
            const lon = checkbox.getAttribute('data-lon');
            return `${lat},${lon}`;
          });

          if (coordinates.length > 0) {
            const destination = coordinates.pop();
            const waypoints = coordinates.join('|');

            const baseUrl = 'https://www.google.com/maps/dir/?api=1&travelmode=driving';
            let routeUrl = `${baseUrl}&origin=${origin}&destination=${destination}`;
            if (waypoints) {
              routeUrl += `&waypoints=${waypoints}`;
            }

            window.open(routeUrl, '_blank');
          } else {
            alert('Please select at least one dustbin to view the optimized route.');
          }
        },
        () => {
          alert('Unable to fetch your current location. Please ensure location services are enabled.');
        }
      );
    }

    // Call the fetchDustbinData function when the page loads
    window.onload = function() {
      fetchDustbinData();
    }
  </script>
</body>
</html>
